<div class="register-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Register</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" placeholder="your@email.com" />
          <mat-icon matPrefix>email</mat-icon>
          @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
            <mat-error>Please enter a valid email</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Username</mat-label>
          <input matInput type="text" formControlName="username" placeholder="Choose a username" />
          <mat-icon matPrefix>person</mat-icon>
          @if (registerForm.get('username')?.invalid && registerForm.get('username')?.touched) {
            <mat-error>Username is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Password</mat-label>
          <input matInput type="password" formControlName="password" placeholder="Enter your password" />
          <mat-icon matPrefix>lock</mat-icon>
          @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
            <mat-error>
              @if (registerForm.get('password')?.hasError('required')) {
                Password is required
              } @else if (registerForm.get('password')?.hasError('minlength')) {
                Password must be at least 8 characters
              } @else if (registerForm.get('password')?.hasError('pattern')) {
                Password must contain at least one uppercase, one number, and one special character
              }
            </mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm Password</mat-label>
          <input matInput type="password" formControlName="confirmPassword" placeholder="Confirm your password" />
          <mat-icon matPrefix>lock</mat-icon>
          @if (registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched) {
            <mat-error>Passwords do not match</mat-error>
          }
        </mat-form-field>

        <div class="upload-section">
          <label for="photo-upload" class="upload-label">
            <mat-icon>photo_camera</mat-icon>
            <span>Upload Profile Photo</span>
          </label>
          <input
            id="photo-upload"
            type="file"
            accept="image/*"
            (change)="onFileSelected($event)"
            class="file-input"
          />
          @if (croppedPhotoData) {
            <div class="photo-preview">
              <img [src]="croppedPhotoData" alt="Profile photo preview" />
              <p class="file-name">{{ selectedFileName }}</p>
            </div>
          } @else if (selectedFileName) {
            <p class="file-name">{{ selectedFileName }}</p>
          }
        </div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="full-width"
          [disabled]="registerForm.invalid"
        >
          Create Account
        </button>

        <div class="login-section">
          <p>Already have an account?</p>
          <button mat-stroked-button color="primary" type="button" class="full-width" (click)="navigateToLogin()">
            Login
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
